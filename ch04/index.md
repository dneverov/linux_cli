# Операции с файлами и каталогами

Команды для работы с файлами и каталогами:

- `cp` — копирует файлы и каталоги;
- `mv` — перемещает/переименовывает файлы и каталоги;
- `mkdir` — создает каталоги;
- `rm` — удаляет файлы и каталоги;
- `ln` — создает жесткие и символьные ссылки.

**Пр.**  
…скопировать файлы HTML из одного каталога в другой, причем только те, что отсутствуют в каталоге назначения или имеют  более позднюю дату последнего изменения.

```
cp -u *.html destination
```


## Групповые символы

Командная оболочка поддерживает специальные симвоолы, помогающие быстро определять группы имен файлов. Эти специальные символы называют _групповыми символами_ (wildcards). Также известны как _символы подстановки_ (globbing) позволяют выбирать имена файлов по шаблону.


### 4.1 Групповые символы

- `*` — Любая последовательность любых символов
- `?` — Любой один символ
- `[символы]` — Любой один символ из указанного множества символов
- `[!символы]` — Любой один символ, не принадлежащий указанному множеству символов
- `[[:класс:]]` — Любой один символ, принадлежащий указанному классу


### 4.2 Наиболее часто используемые классы символов

- `[:alnum:]` — Любой алфавитно-цифровой символ
- `[:alpha:]` — Любой алфавитный символ
- `[:digit:]` — Любой цифровой символ
- `[:lower:]` — Любая буква в нижнем регистре
- `[:upper:]` — Любая буква в верхнем регистре


Групповые символы также действуют в графическом интерфейсе

- В Nautilus (GNOME) можно выбирать файлы с помощью диалога Edit (Правка) - Select Pattern (Выделить по шаблону).

- В некоторых версиях Dolphin и Konqueror (KDE) групповые символы можно вводить непоредственно в адресную строку.


### 4.3 Примеры использования групповых символов

- `*` — Все имена файлов;
- `g*` — Все имена файлов, начинающиеся с символа `g`;
- `b*.txt` — Все имена файлов, начинающиеся с символа `b`, за которым следует любое число других символов, и заканчивающиеся на `.txt`;
- `Data???` — Все имена файлов, начинающиеся с символов `Data`, за которыми следуют ровно три любых символа;
- `[abc]*` — Все имена файлов, начинающиеся с символа `a`, `b` или `c`;
- `BACKUP.[0-9][0-9][0-9]` — Все имена файлов, начинающиеся с символов `BACKUP.`, за которыми следуют ровно три цифровых символа;
- `[[:upper:]]*` — Все имена файлов, начинающиеся с буквы в верхнем регистре;
- `[![:digit:]]*` — Все имена файлов, не начинающиеся с цифры;
- `*[[:lower:]123]` — Все имена файлов, заканчивающиеся буквой в нижнем регистре или цифрой `1`, `2` или `3`.


Групповые символы можно использовать с любыми командами, принимающими имена файлов в виде аргументов.


#### Диапазоны символов

`[A-Z]` или `[a-z]`... будьте очень осторожны при их использовании, потому что они не всегда дают ожидаемый результат без правильной настройки. А вообще старайтесь избегать их и использовать классы символов.


### mkdir — создание каталогов

Команда `mkdir` используется для создания каталогов. Вызывается она следующим образом:

    mkdir каталог...

**Примечание к форме записи:** в этой книге три точки в описании команды, следующие за аргументом (как в примере выше), говорят о том, что аргументов будет несколько.

    mkdir dir1

создаст один каталог с именем _dir1_

    mkdir dir1 dir2 dir3

создаст три каталога с именами _dir1_, _dir2_ и _dir3_.


### cp — копирование файлов или каталогов

    cp item1 item2

чтобы скопировать один файл или каталог _item1_ в файл или каталог _item2_.

    cp элемент... каталог

чтобы скопировать несколько элементов (файлов или каталогов) в указанный каталог.


#### 4.4. Параметры команды cp

- `-a, --archive` — Скопировать файлы и каталоги со всеми атрибутами, включая идентификаторы владельцев и права доступа;
- `-i, --interactive` — Запрашивать у пользователя подтверждение перед перезаписью существующего файла;
- `-r, --recursive` — Рекурсивно копировать каталоги и их содержимое. Это **обязательный** параметр (или параметр `-a`) при копировании **каталогов**;
- `-u, --update` — При копировании файлов из одного каталога в другой копировать только файлы, отсутствующие в каталоге назначения или более новые;
- `-v, --verbose` — Выводить информационные сообщения в процессе копирования.


#### 4.5. Примеры использования команды cp

`cp file1 file2`

`cp -i file1 file2`

`cp file1 file2 dir1` — скопирует _file1_ и _file2_ в каталог _dir1_ (должен существовать)

`cp dir1/* dir2` — скопирует все файлы из каталога _dir1_ в каталог _dir2_ (должен существовать)

`cp -r dir1 dir2` — скопирует содержимое каталога _dir1_ в каталог _dir2_. Если каталог _dir2_ не существует, он будет создан и заполнен содержимым каталога _dir1_. Если каталог _dir2_ существует, тогда в него будет скопирован сам каталог _dir1_ (вместе с его содержимым).


### mv — перемещение и переименование файлов

> В любом случае исходный файл исчезнет после операции.

Команда **mv** испольуется почти так же, как команда **cp**.

    mv item1 item2

перемещает или переименовывает файл или каталог _item1_ в _item2_.

    mv элемент... каталог

перемещает один или более элементов из одного каталога в другой.


#### 4.6 Параметры команды **mv**

Похожие параметры как и **cp**

- `-i, --interactive`
- `-u, --update`
- `-v, --verbose`


#### 4.7. Примеры использования команды **mv**

`mv file1 file2`

`mv -i file1 file2`

`mv file1 file2 dir1`

`mv dir1 dir2`


### rm — удаление файлов и каталогов

    rm элемент...

где **элемент** — один или несколько файлов или каталогов


#### 4.8 Параметры команды **rm**

- `-i, --interactive` — Запрашивать у пользователя подтверждение перед удалением существующего файла. **Если параметр отсутствует, команда `rm` просто удалит существующие файлы**
- `-r, --recursive` — Рекурсивно удалить каталоги. То есть вместе с каталогом будут удалены все его подкаталоги. Это **обязательный** параметр при удалении **каталогов**
- `-f, --force` — Игнорировать отсутствующие файлы и не запрашивать подтверждения. Этот параметр отменяет действие параметра `--interactive`
- `-v, --verbose`

> #### Будьте осторожны с командой rm!
Если вы что-то удалили командой `rm`, это исчезнет навсегда.
>
> Будьте особенно осторожны с групповыми символами.
>
> **Полезный совет:** всякий раз, используя групповые символы с командой `rm` (помимо внимательной проверки ввода!), проверьте сначала с командой `ls`. Это позволит увидеть, какие файлы будут удалены.


#### 4.9. Примеры использования команды **rm**

`rm file1`

`rm -i file1` — Перед удалением _file1_ запросит подтверждение.

`rm -r file1 dir1` — Удалит файл _file1_ и каталог _dir1_ со всем его содержимым

`rm -rf file1 dir1` — То же, что и выше, но в отсутствие _file1_ и/или _dir1_ просто продолжит работу, не выводя никаких сообщений.


### ln — создание ссылок

```
ln файл ссылка
```
создает жесткую ссылку

```
ln элемент ссылка
```
создает симолическую ссылку. элемент — файл или каталог


### Постройка песочницы

```
cd
mkdir playground

cd playground
mkdir dir1 dir2

cp /etc/passwd .
ls -l
```

```
cp -v /etc/passwd .
cp -i /etc/passwd .
```

#### Move, Rename

```
mv passwd fun
mv fun dir1
mv dir1/fun dir2
mv dir2/fun .
```

```
mv fun dir1
mv dir1 dir2
ls -l dir2

mv dir2/dir1 .
mv dir1/fun .
```

#### Создание жестких ссылок

```
mv dir2/dir1 .
mv dir1/fun .
ln fun fun-hard
ln fun dir1/fun-hard
ln fun dir2/fun-hard
ls -l
```

```
ls -li
```
В этой версии списка в первом поле отображается номер _индексного узла_ (inode).


#### Создание символических ссылок

Символические ссылки были придуманы с целью преодолеть ограничения жестких ссылок.

- жесткие ссылки не могут указывать на файлы, находящиеся на других физических устройствах;
- жесткие ссылки не могут указывать на каталоги — только на файлы.


Создаются смволические ссылки почти так же, как жесткие ссылки:

```
ln -s fun fun-sym
ln -s ../fun dir1/fun-sym
ln -s ../fun dir2/fun-sym

```

Посмотреть на вывод комады `ls`:
```
ls -l dir1
# total 4
# -rw-r--r-- 4 denis denis 2770 фев  8 00:12 fun-hard
# lrwxrwxrwx 1 denis denis    6 фев  8 00:33 fun-sym -> ../fun
```

При создании символических ссылок можно также указывать абсолютные пути:

```
ln -s /home/me/playground/fun dir1/fun-sym
```

Предпочтительнее использовать относительные пути.

Символические ссылки могут указывать также на каталоги:


```
ln -s dir1 dir1-sym
ls -l
```


#### Удаление файлов и каталогов


При помощи команды `rm`:

```
rm fun-hard
ls -l
```

Далее, удалите файл _fun_ и ради развлечения добавьте в команду параметр `-i`:

```
rm -i fun
```
> rm: remove regular file 'fun'? 

Введите `y` в ответ на запрос, и файл будет удален.

```
ls -l
```

Поскольку теперь символическая ссылка _fun-sym_ указывает на несуществующий файл, она стала битой.

Удалите символическую ссылку:

```
rm fun-sym dir1-sym
ls -l
```

В заключение удалим каталог _playground_. Ключ рекурсивного удаления `-r`

```
cd
rm -r playground
```


##### GNOME

---
Если в GNOME во время перетаскивания файла мышью удерживать нажатыми клавиши `Ctrl` и `Shift` будет выполнена операция создания ссылки.

---

[Глава 5](../ch05/index.md)
